<!DOCTYPE html><html lang="en" class="scroll-smooth"> <head><meta charset="utf-8"><link rel="icon" type="image/jpg" href="/favicon.webp"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.16.5"><script src="/scripts/gTagManager.js"></script><meta name="title" content="M. Moeen - JWT in Node"><meta name="description" content="JWTs are a great alternative to sessions and cookies. This article walks through usage of JWTs in NodeJS."><meta property="og:title" content="M. Moeen - JWT in Node"><meta property="og:description" content="JWTs are a great alternative to sessions and cookies. This article walks through usage of JWTs in NodeJS."><meta property="og:image" content="https://moeenn.github.io/logo.webp"><meta property="og:url" content="https://moeenn.github.io/blogs/undefined"><meta property="og:site_name" content="M. Moeen - JWT in Node"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://moeenn.github.io/blogs/undefined"><meta property="twitter:title" content="M. Moeen - JWT in Node"><meta property="twitter:image" content="https://moeenn.github.io/logo.webp"><meta property="twitter:description" content="JWTs are a great alternative to sessions and cookies. This article walks through usage of JWTs in NodeJS."><title>M. Moeen - JWT in Node</title><link rel="stylesheet" href="/assets/blogs.CyOt0-9k.css"></head> <body class="text-black h-screen flex flex-col"> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M6RFWPQD" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> <div class="container max-w-6xl mx-auto px-6 lg:px-10">  <nav> <div class="pt-8 pb-4 flex justify-between"> <a class="my-auto cursor-pointer" href="/#"> <span class="font-mono pb-1 pt-2 font-bold text-white bg-gray-900 px-3 py-1 rounded">M.M</span> </a> <div class="block md:hidden"> <div class="flex space-x-2"> <a href="https://github.com/moeenn" target="_blank" class="my-auto hover:bg-gray-200 transition-colors rounded-full h-10 w-10 inline-flex" title="Github"> <svg class="size-6 m-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"> <rect width="256" height="256" fill="none"></rect><path d="M119.83,56A52,52,0,0,0,76,32a51.92,51.92,0,0,0-3.49,44.7A49.28,49.28,0,0,0,64,104v8a48,48,0,0,0,48,48h48a48,48,0,0,0,48-48v-8a49.28,49.28,0,0,0-8.51-27.3A51.92,51.92,0,0,0,196,32a52,52,0,0,0-43.83,24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M104,232V192a32,32,0,0,1,32-32h0a32,32,0,0,1,32,32v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M104,208H72a32,32,0,0,1-32-32A32,32,0,0,0,8,144" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path> </svg> </a> <a href="https://www.linkedin.com/in/moeenn" target="_blank" class="my-auto hover:bg-gray-200 transition-colors rounded-full h-10 w-10 inline-flex" title="LinkedIn"> <svg class="size-6 m-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><rect x="32" y="32" width="192" height="192" rx="8" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></rect><line x1="120" y1="112" x2="120" y2="176" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></line><line x1="88" y1="112" x2="88" y2="176" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></line><path d="M120,140a28,28,0,0,1,56,0v36" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><circle cx="88" cy="84" r="12"></circle></svg> </a> <div data-navbutton class="hover:bg-gray-200 rounded p-2 cursor-pointer"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="text-gray-700 h-6 w-6"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5"></path> </svg> </div> </div> </div> <div class="hidden md:flex md:space-x-2"> <a href="/#career" class="px-3 py-2 text-black text-sm my-auto border-b-2 border-transparent hover:border-black hover:bg-gray-200 rounded-t transition-colors"> Career </a><a href="/#projects" class="px-3 py-2 text-black text-sm my-auto border-b-2 border-transparent hover:border-black hover:bg-gray-200 rounded-t transition-colors"> Projects </a><a href="/#tools" class="px-3 py-2 text-black text-sm my-auto border-b-2 border-transparent hover:border-black hover:bg-gray-200 rounded-t transition-colors"> Skills &amp; Tools </a><a href="/#contact" class="px-3 py-2 text-black text-sm my-auto border-b-2 border-transparent hover:border-black hover:bg-gray-200 rounded-t transition-colors"> Contact Me </a> <a href="/blogs" class="px-3 py-2 font-bold text-black text-sm my-auto hover:bg-gray-200 border-b-2 border-transparent hover:border-black rounded-t transition-colors">
Blogs
</a> <div class="flex px-2"> <span class="my-auto text-gray-300">|</span> </div> <div class="flex space-x-2"> <a href="https://github.com/moeenn" target="_blank" class="my-auto hover:bg-gray-200 transition-colors rounded-full h-10 w-10 inline-flex" title="Github"> <svg class="size-6 m-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"> <rect width="256" height="256" fill="none"></rect><path d="M119.83,56A52,52,0,0,0,76,32a51.92,51.92,0,0,0-3.49,44.7A49.28,49.28,0,0,0,64,104v8a48,48,0,0,0,48,48h48a48,48,0,0,0,48-48v-8a49.28,49.28,0,0,0-8.51-27.3A51.92,51.92,0,0,0,196,32a52,52,0,0,0-43.83,24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M104,232V192a32,32,0,0,1,32-32h0a32,32,0,0,1,32,32v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M104,208H72a32,32,0,0,1-32-32A32,32,0,0,0,8,144" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path> </svg> </a> <a href="https://www.linkedin.com/in/moeenn" target="_blank" class="my-auto hover:bg-gray-200 transition-colors rounded-full h-10 w-10 inline-flex" title="LinkedIn"> <svg class="size-6 m-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><rect x="32" y="32" width="192" height="192" rx="8" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></rect><line x1="120" y1="112" x2="120" y2="176" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></line><line x1="88" y1="112" x2="88" y2="176" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></line><path d="M120,140a28,28,0,0,1,56,0v36" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><circle cx="88" cy="84" r="12"></circle></svg> </a> </div> </div> </div> <div data-mobilemenu class="hidden"> <div class="flex flex-col md:hidden bg-gray-100 rounded"> <a href="/#career" class="px-3 py-4 text-black leading-none hover:bg-gray-300 text-sm my-auto transition-colors mb-0 rounded"> Career </a><a href="/#projects" class="px-3 py-4 text-black leading-none hover:bg-gray-300 text-sm my-auto transition-colors mb-0 rounded"> Projects </a><a href="/#tools" class="px-3 py-4 text-black leading-none hover:bg-gray-300 text-sm my-auto transition-colors mb-0 rounded"> Skills &amp; Tools </a><a href="/#contact" class="px-3 py-4 text-black leading-none hover:bg-gray-300 text-sm my-auto transition-colors mb-0 rounded"> Contact Me </a> <a href="/blogs" class="px-3 py-4 text-black leading-none hover:bg-gray-300 text-sm my-auto transition-colors mb-0 rounded">
Blogs
</a> </div> </div> </nav> <script src="/scripts/navbar.js" defer></script>  </div> <main class="flex-1">  <div class="container max-w-6xl mx-auto px-6 lg:px-10">  <div class="pt-8 pb-14"> <h2 class="text-2xl space-x-2 mb-5"> <span class="font-normal text-gray-500">#</span> <span class="text-gray-900">JWT in Node</span> </h2> <div class="prose-xl"> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> npm</span><span style="color:#9ECBFF"> i</span><span style="color:#9ECBFF"> jsonwebtoken</span><span style="color:#9ECBFF"> zod</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> npm</span><span style="color:#9ECBFF"> i</span><span style="color:#79B8FF"> -D</span><span style="color:#9ECBFF"> @types/jsonwebtoken</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> jwt </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "jsonwebtoken"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { z } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "zod"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@typedef</span><span style="color:#B392F0"> {"admin" | "user"}</span><span style="color:#B392F0"> UserRole</span></span>
<span class="line"><span style="color:#6A737D"> *</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@typedef</span><span style="color:#B392F0"> User</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> user_id</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> email</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {UserRole}</span><span style="color:#E1E4E8"> role</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@typedef</span><span style="color:#B392F0"> SessionToken</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> accessToken</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> refreshToken</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {number}</span><span style="color:#E1E4E8"> expiry</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@typedef</span><span style="color:#B392F0"> JWTEncoded</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> token</span></span>
<span class="line"><span style="color:#6A737D"> * </span><span style="color:#F97583">@property</span><span style="color:#B392F0"> {number}</span><span style="color:#E1E4E8"> expiry</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> SESSION_REFRESH_TOKEN_SCOPE</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "session.refresh"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> SESSION_ACCESS_TOKEN_SCOPE</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "session.access"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> SessionRefreshToken</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {string}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#FFAB70">	userId</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {string}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#FFAB70">	email</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {UserRole}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#FFAB70">	role</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {string}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#FFAB70">	scope</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> userId</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> email</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {UserRole}</span><span style="color:#E1E4E8"> role</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">userId</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">email</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">role</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.userId </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> userId;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.email </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> email;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.role </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> role;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.scope </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> SESSION_REFRESH_TOKEN_SCOPE</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {JWTEncoded}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#B392F0">	encode</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> token</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> JWT</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">generateNonExpiringToken</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">			userId: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.userId,</span></span>
<span class="line"><span style="color:#E1E4E8">			email: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.email,</span></span>
<span class="line"><span style="color:#E1E4E8">			role: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.role,</span></span>
<span class="line"><span style="color:#E1E4E8">			scope: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.scope,</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#E1E4E8"> { token, expiry: </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {unknown}</span><span style="color:#E1E4E8"> payload</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {SessionRefreshToken | undefined}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#E1E4E8"> #</span><span style="color:#B392F0">validatePayload</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">payload</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> schema</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> z.</span><span style="color:#B392F0">object</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">			userId: z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">uuid</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">			email: z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">email</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">			role: z.</span><span style="color:#B392F0">enum</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">"admin"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"user"</span><span style="color:#E1E4E8">]),</span></span>
<span class="line"><span style="color:#E1E4E8">			scope: z.</span><span style="color:#B392F0">literal</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">SESSION_REFRESH_TOKEN_SCOPE</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> v</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> schema.</span><span style="color:#B392F0">safeParse</span><span style="color:#E1E4E8">(payload);</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">v.success) {</span></span>
<span class="line"><span style="color:#F97583">			return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SessionRefreshToken</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">			v.data.userId,</span></span>
<span class="line"><span style="color:#E1E4E8">			v.data.email,</span></span>
<span class="line"><span style="color:#E1E4E8">			v.data.role,</span></span>
<span class="line"><span style="color:#E1E4E8">		);</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> token</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@return</span><span style="color:#B392F0"> {SessionRefreshToken | undefined}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#B392F0"> validate</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">token</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">			const</span><span style="color:#79B8FF"> payload</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> jwt.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(token, config.jwt.secret);</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> payload </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> "string"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">			return</span><span style="color:#E1E4E8"> SessionRefreshToken.</span><span style="color:#B392F0">#validatePayload</span><span style="color:#E1E4E8">(payload);</span></span>
<span class="line"><span style="color:#E1E4E8">		} </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> SessionAccessToken</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> SessionRefreshToken</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {number}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#FFAB70">	expiry</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {string}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#FFAB70">	scope</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> userId</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> email</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {UserRole}</span><span style="color:#E1E4E8"> role</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">userId</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">email</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">role</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">		super</span><span style="color:#E1E4E8">(userId, email, role);</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.scope </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> SESSION_ACCESS_TOKEN_SCOPE</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.expiry </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> JWT</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">calculateExpiry</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {JWTEncoded}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#B392F0">	enodeWithExpiry</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#79B8FF"> JWT</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">generateExpiringToken</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">			userId: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.userId,</span></span>
<span class="line"><span style="color:#E1E4E8">			email: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.email,</span></span>
<span class="line"><span style="color:#E1E4E8">			role: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.role,</span></span>
<span class="line"><span style="color:#E1E4E8">			scope: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.scope,</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {unknown}</span><span style="color:#E1E4E8"> payload</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {SessionAccessToken | undefined}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#E1E4E8"> #</span><span style="color:#B392F0">validatePayload</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">payload</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> schema</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> z.</span><span style="color:#B392F0">object</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">			userId: z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">uuid</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">			email: z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">email</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">			role: z.</span><span style="color:#B392F0">enum</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">"admin"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"user"</span><span style="color:#E1E4E8">]),</span></span>
<span class="line"><span style="color:#E1E4E8">			scope: z.</span><span style="color:#B392F0">literal</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">SESSION_ACCESS_TOKEN_SCOPE</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> v</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> schema.</span><span style="color:#B392F0">safeParse</span><span style="color:#E1E4E8">(payload);</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">v.success) {</span></span>
<span class="line"><span style="color:#F97583">			return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SessionAccessToken</span><span style="color:#E1E4E8">(v.data.userId, v.data.email, v.data.role);</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {string}</span><span style="color:#E1E4E8"> token</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@return</span><span style="color:#B392F0"> {SessionAccessToken | undefined}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#B392F0"> validate</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">token</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">			const</span><span style="color:#79B8FF"> payload</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> jwt.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(token, config.jwt.secret);</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> payload </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> "string"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">			return</span><span style="color:#E1E4E8"> SessionAccessToken.</span><span style="color:#B392F0">#validatePayload</span><span style="color:#E1E4E8">(payload);</span></span>
<span class="line"><span style="color:#E1E4E8">		} </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> JWTFactory</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * create access and refresh tokens for the user at successful login</span></span>
<span class="line"><span style="color:#6A737D">	 *</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {User}</span><span style="color:#E1E4E8"> user</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {SessionToken}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#B392F0"> generateSessionToken</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">user</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> accessPayload</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SessionAccessToken</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">			user.user_id,</span></span>
<span class="line"><span style="color:#E1E4E8">			user.email,</span></span>
<span class="line"><span style="color:#E1E4E8">			user.role,</span></span>
<span class="line"><span style="color:#E1E4E8">		).</span><span style="color:#B392F0">enodeWithExpiry</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> refreshPayload</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SessionRefreshToken</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">			user.user_id,</span></span>
<span class="line"><span style="color:#E1E4E8">			user.email,</span></span>
<span class="line"><span style="color:#E1E4E8">			user.role,</span></span>
<span class="line"><span style="color:#E1E4E8">		).</span><span style="color:#B392F0">encode</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">			accessToken: accessPayload.token,</span></span>
<span class="line"><span style="color:#E1E4E8">			expiry: accessPayload.expiry,</span></span>
<span class="line"><span style="color:#E1E4E8">			refreshToken: refreshPayload.token,</span></span>
<span class="line"><span style="color:#E1E4E8">		};</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> JWT</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * calculate expiry timestamp for the client</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {number}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#B392F0"> calculateExpiry</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">			Math.</span><span style="color:#B392F0">floor</span><span style="color:#E1E4E8">(Date.</span><span style="color:#B392F0">now</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 60</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 60</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> config.jwt.expiresInHours</span></span>
<span class="line"><span style="color:#E1E4E8">		);</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {object}</span><span style="color:#E1E4E8"> payload</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {JWTEncoded}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#B392F0"> generateExpiringToken</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">payload</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> token</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> jwt.</span><span style="color:#B392F0">sign</span><span style="color:#E1E4E8">(payload, config.jwt.secret, {</span></span>
<span class="line"><span style="color:#E1E4E8">			expiresIn: </span><span style="color:#79B8FF">60</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 60</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> config.jwt.expiresInHours,</span></span>
<span class="line"><span style="color:#E1E4E8">			notBefore: </span><span style="color:#9ECBFF">"0"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">			algorithm: config.jwt.algorithm,</span></span>
<span class="line"><span style="color:#E1E4E8">			issuer: config.jwt.issuer,</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		const</span><span style="color:#79B8FF"> expiry</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">calculateExpiry</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#E1E4E8"> { token, expiry };</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/**</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@param</span><span style="color:#B392F0"> {object}</span><span style="color:#E1E4E8"> payload</span></span>
<span class="line"><span style="color:#6A737D">	 * </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {string}</span></span>
<span class="line"><span style="color:#6A737D">	 */</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#B392F0"> generateNonExpiringToken</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">payload</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#E1E4E8"> jwt.</span><span style="color:#B392F0">sign</span><span style="color:#E1E4E8">(payload, config.jwt.secret, {</span></span>
<span class="line"><span style="color:#E1E4E8">			notBefore: </span><span style="color:#9ECBFF">"0"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">			algorithm: config.jwt.algorithm,</span></span>
<span class="line"><span style="color:#E1E4E8">			issuer: config.jwt.issuer,</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> config</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">	jwt: {</span></span>
<span class="line"><span style="color:#E1E4E8">		secret: </span><span style="color:#9ECBFF">"super-secret-secret"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">		expiresInHours: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">		algorithm: </span><span style="color:#6A737D">/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {jwt.Algorithm}</span><span style="color:#6A737D"> */</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"HS256"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">		issuer: </span><span style="color:#9ECBFF">"host.com"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	},</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/** </span><span style="color:#F97583">@returns</span><span style="color:#B392F0"> {Promise&#x3C;void>}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">async</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">	/** </span><span style="color:#F97583">@type</span><span style="color:#B392F0"> {User}</span><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">	const</span><span style="color:#79B8FF"> user</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">		user_id: crypto.</span><span style="color:#B392F0">randomUUID</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">		email: </span><span style="color:#9ECBFF">"user@site.com"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">		role: </span><span style="color:#9ECBFF">"admin"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	const</span><span style="color:#79B8FF"> payload</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> JWTFactory.</span><span style="color:#B392F0">generateSessionToken</span><span style="color:#E1E4E8">(user);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	const</span><span style="color:#79B8FF"> accessToken</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> SessionAccessToken.</span><span style="color:#B392F0">validate</span><span style="color:#E1E4E8">(payload.accessToken);</span></span>
<span class="line"><span style="color:#E1E4E8">	console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(accessToken));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	const</span><span style="color:#79B8FF"> refreshToken</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> SessionRefreshToken.</span><span style="color:#B392F0">validate</span><span style="color:#E1E4E8">(payload.refreshToken);</span></span>
<span class="line"><span style="color:#E1E4E8">	console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(refreshToken));</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">main</span><span style="color:#E1E4E8">();</span></span></code></pre> </div> </div>  </div>  </main> <footer class="py-4 bg-gray-200 text-gray-500"> <div class="container max-w-6xl mx-auto px-6 lg:px-10">  <div class="flex"> <span class="text-sm mx-auto">Â© 2025 - Muhammad Moeen</span> </div>  </div> </footer> <div data-scrollbuttoncontainer class="transition-all duration-300 opacity-0 cursor-pointer"> <button data-scrollbutton title="Go To Top" class="fixed z-90 bottom-8 right-8 border-0 w-12 h-12 rounded-full drop-shadow-md bg-black text-white text-3xl font-bold"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4 m-auto"> <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5"></path> </svg> </button> </div> <script src="/scripts/scrolltop.js" defer></script> </body></html>